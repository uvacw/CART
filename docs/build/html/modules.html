

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Modules &mdash; CART - Conversational Agent Research Toolkit 1.00 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Tutorial" href="tutorial.html" />
    <link rel="prev" title="Using CART" href="using.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> CART - Conversational Agent Research Toolkit
          

          
          </a>

          
            
            
              <div class="version">
                1.00
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="about.html">About CART</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="using.html">Using CART</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Modules</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#module-helpers.check_db">check_db</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-helpers.log_conversations">log_conversations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-helpers.rephrase">rephrase</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">CART - Conversational Agent Research Toolkit</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Modules</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/modules.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="modules">
<span id="id1"></span><h1>Modules<a class="headerlink" href="#modules" title="Permalink to this headline">¶</a></h1>
<p>Note: see the <a class="reference internal" href="using.html#using"><span class="std std-ref">Using CART</span></a> for more information on how to use these functions.</p>
<div class="section" id="module-helpers.check_db">
<span id="check-db"></span><h2>check_db<a class="headerlink" href="#module-helpers.check_db" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt id="helpers.check_db.check_db">
<code class="sig-prename descclassname">helpers.check_db.</code><code class="sig-name descname">check_db</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#helpers.check_db.check_db" title="Permalink to this definition">¶</a></dt>
<dd><p>Connects to the databse informed in the configuration file and checks whether all tables are created. If tables are missing, it creates the tables. Does not return any values.</p>
</dd></dl>

</div>
<div class="section" id="module-helpers.log_conversations">
<span id="log-conversations"></span><h2>log_conversations<a class="headerlink" href="#module-helpers.log_conversations" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt id="helpers.log_conversations.assign_conditions">
<code class="sig-prename descclassname">helpers.log_conversations.</code><code class="sig-name descname">assign_conditions</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">db</span></em><span class="sig-paren">)</span><a class="headerlink" href="#helpers.log_conversations.assign_conditions" title="Permalink to this definition">¶</a></dt>
<dd><p>Assigns the condition to a new conversation based on the configurations available at the <code class="docutils literal notranslate"><span class="pre">config.yaml</span></code> file (section: experimental_design).</p>
<p>If the <code class="docutils literal notranslate"><span class="pre">assignment_manager</span></code> is set to <code class="docutils literal notranslate"><span class="pre">CART</span></code>, it works as follows:</p>
<ol class="arabic simple">
<li><p>It uses the conditions available at the <code class="docutils literal notranslate"><span class="pre">config.yaml</span></code> file to determine the conditions for the experiment, and uses the condition_name as the value to be informed.</p></li>
<li><p>It assigns the condition to the new conversation depending on the <code class="docutils literal notranslate"><span class="pre">assignment_method</span></code> in the <code class="docutils literal notranslate"><span class="pre">config.yaml</span></code> file:</p></li>
</ol>
<ul class="simple">
<li><p>If the <code class="docutils literal notranslate"><span class="pre">assignment_method</span></code> is set to <code class="docutils literal notranslate"><span class="pre">fully_random</span></code>, it will randomly choose among the conditions.</p></li>
<li><p>If the <code class="docutils literal notranslate"><span class="pre">assignment_method`</span> <span class="pre">is</span> <span class="pre">set</span> <span class="pre">to</span> <span class="pre">``random_balanced</span></code>, it will return the condition with the lowest count in the database and, if all conditions are equally balanaced, will return a random choice among the conditions.</p></li>
<li><p>If the <code class="docutils literal notranslate"><span class="pre">assignment_method`</span> <span class="pre">is</span> <span class="pre">set</span> <span class="pre">to</span> <span class="pre">``sequential</span></code>, it will return the next condition (as per the order in the config file) compared to the last conversation available in the database.</p></li>
</ul>
</dd></dl>

<dl class="py function">
<dt id="helpers.log_conversations.check_participantid">
<code class="sig-prename descclassname">helpers.log_conversations.</code><code class="sig-name descname">check_participantid</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">resp</span></em>, <em class="sig-param"><span class="n">status</span></em>, <em class="sig-param"><span class="n">conditionid</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#helpers.log_conversations.check_participantid" title="Permalink to this definition">¶</a></dt>
<dd><p>Module to start the validation of the participant id if the questionnaire_flow == during or after, and if the response by the dialogue manager contains the key parameters, and inside parameters, the key that in <code class="docutils literal notranslate"><span class="pre">config.yaml</span></code> was assigned as participantid_dialog_field.</p>
</dd></dl>

<dl class="py function">
<dt id="helpers.log_conversations.get_conversation_status">
<code class="sig-prename descclassname">helpers.log_conversations.</code><code class="sig-name descname">get_conversation_status</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">db</span></em>, <em class="sig-param"><span class="n">conversationid</span></em>, <em class="sig-param"><span class="n">message</span></em>, <em class="sig-param"><span class="n">resp</span></em>, <em class="sig-param"><span class="n">participantid</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#helpers.log_conversations.get_conversation_status" title="Permalink to this definition">¶</a></dt>
<dd><p>Receives the conversationid and the message from the user, and uses this information to determine the conversation status.</p>
<blockquote>
<div><p>If the conversationid is found in the database (table conversations), the function increases the number of turns by 1, and returns the status, conversation_code and the conditionid.</p>
<p>If the conversationid is not found, it will create a new row in the table conversations, and include:</p>
<ul class="simple">
<li><p>conversation_code: created using the <code class="docutils literal notranslate"><span class="pre">conversationcode_suffix</span></code> + the <code class="docutils literal notranslate"><span class="pre">conversationcode_base</span></code> (number) from the <code class="docutils literal notranslate"><span class="pre">config.yaml</span></code> file, incremented by the number of conversations already in the database.</p></li>
<li><p>conditionid: created using the assign_conditions function</p></li>
<li><p>status: 0 (for conversation that has started)</p></li>
<li><p>turns: 1</p></li>
</ul>
</div></blockquote>
<p>The function also calls <code class="docutils literal notranslate"><span class="pre">assign_conditions()</span></code> to assign conditions (when CART is set as the assignment manager in <code class="docutils literal notranslate"><span class="pre">config.yaml</span></code>), and <code class="docutils literal notranslate"><span class="pre">check_participantid()</span></code> to determine if the integration with the survey requires checking the participant id.</p>
</dd></dl>

<dl class="py function">
<dt id="helpers.log_conversations.get_first_name">
<code class="sig-prename descclassname">helpers.log_conversations.</code><code class="sig-name descname">get_first_name</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">message</span></em><span class="sig-paren">)</span><a class="headerlink" href="#helpers.log_conversations.get_first_name" title="Permalink to this definition">¶</a></dt>
<dd><p>Function tries to retrieve the first name of the user depending on the message provided by the MS Bot Framework. If it finds a name, it returns the first token. If not, returns an empty string.</p>
</dd></dl>

<dl class="py function">
<dt id="helpers.log_conversations.log_message">
<code class="sig-prename descclassname">helpers.log_conversations.</code><code class="sig-name descname">log_message</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">db</span></em>, <em class="sig-param"><span class="n">message</span></em>, <em class="sig-param"><span class="n">participantid</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#helpers.log_conversations.log_message" title="Permalink to this definition">¶</a></dt>
<dd><p>Logger module for messages coming from the participant.</p>
<p>Requires:</p>
<ul class="simple">
<li><p>A db object (from db_class)</p></li>
<li><p>A message dictionary containing, at least:</p></li>
</ul>
<p>– [‘text’] - text of the message</p>
<p>– [‘conversation’][‘id’] - with the id of the conversation</p>
<p>– [‘from’][‘name’] - with the name (or anonymised name) of the participant</p>
<ul class="simple">
<li><p>Optionally: the participantID</p></li>
</ul>
</dd></dl>

<dl class="py function">
<dt id="helpers.log_conversations.log_response">
<code class="sig-prename descclassname">helpers.log_conversations.</code><code class="sig-name descname">log_response</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">db</span></em>, <em class="sig-param"><span class="n">message</span></em>, <em class="sig-param"><span class="n">resp_speech</span></em>, <em class="sig-param"><span class="n">resp</span></em>, <em class="sig-param"><span class="n">participantid</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#helpers.log_conversations.log_response" title="Permalink to this definition">¶</a></dt>
<dd><p>Logger module for messages coming from the agent.</p>
<p>Requires:</p>
<ul class="simple">
<li><p>A db object (from db_class)</p></li>
<li><p>A message dictionary containing, at least:</p></li>
</ul>
<p>– [‘text’] - text of the message</p>
<p>– [‘conversation’][‘id’] - with the id of the conversation</p>
<p>– [‘from’][‘name’] - with the name (or anonymised name) of the participant</p>
<ul class="simple">
<li><p>Optionally: the participantID</p></li>
<li><p>The text of the message (response of the agent)</p></li>
<li><p>The message object sent to the publishing platform</p></li>
<li><p>The response sent by the NLU/dialogue management module</p></li>
</ul>
</dd></dl>

<dl class="py function">
<dt id="helpers.log_conversations.validate_participantid">
<code class="sig-prename descclassname">helpers.log_conversations.</code><code class="sig-name descname">validate_participantid</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">participantid</span></em>, <em class="sig-param"><span class="n">participantid_valid_suffixes</span></em>, <em class="sig-param"><span class="n">resp</span></em>, <em class="sig-param"><span class="n">conditionid</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#helpers.log_conversations.validate_participantid" title="Permalink to this definition">¶</a></dt>
<dd><p>Module to validate participantid provided by the dialogue manager. Receives the participantid, the participantid_valid_suffixes (from the <code class="docutils literal notranslate"><span class="pre">config.yaml</span></code> file) and returns:</p>
<ul class="simple">
<li><p>The cleaned-up participant id</p></li>
<li><p>If applicable, the conditionid (if assignment_manager is survey)</p></li>
<li><p>The conditionid_status (validated or conditionid_invalid) to determine if the participantid was validated or not.</p></li>
</ul>
</dd></dl>

</div>
<div class="section" id="module-helpers.rephrase">
<span id="rephrase"></span><h2>rephrase<a class="headerlink" href="#module-helpers.rephrase" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt id="helpers.rephrase.check_override">
<code class="sig-prename descclassname">helpers.rephrase.</code><code class="sig-name descname">check_override</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">user_message</span></em><span class="sig-paren">)</span><a class="headerlink" href="#helpers.rephrase.check_override" title="Permalink to this definition">¶</a></dt>
<dd><p>Checks if a message by a user requires any type of override - i.e., stopping the message from going to DialogFlow to get a response.</p>
<p>To do so, it uses the information available in the <code class="docutils literal notranslate"><span class="pre">overrides</span></code> section of the <code class="docutils literal notranslate"><span class="pre">config.yaml</span></code> file. More specifically, it checks if any of the terms contained in the <code class="docutils literal notranslate"><span class="pre">override_terms_in_user_message</span></code> is present in the user_message, with the following rules:</p>
<ul class="simple">
<li><p>If <code class="docutils literal notranslate"><span class="pre">override_terms_case_sensitive</span></code> is set to <code class="docutils literal notranslate"><span class="pre">False</span></code>, it turns the user_message to lower case before continuing. If not, case is preserved.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">override_terms_matching</span></code> is set to <code class="docutils literal notranslate"><span class="pre">full_string</span></code>, it checks the user_message is equal to any of the terms in <code class="docutils literal notranslate"><span class="pre">override_terms_in_user_message</span></code>. For example, if the user_message is “apple” and this is one of the terms, then it will meet the condition. If the user_message is “I like apple”, it won’t match.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">override_terms_matching</span></code> is set to <code class="docutils literal notranslate"><span class="pre">string</span></code>, it checks if each of the terms in <code class="docutils literal notranslate"><span class="pre">override_terms_in_user_message</span></code> is present in the user_message using string matching. For example, the term “apple” would be found in the messages “I like apple” and “I like pineapples”.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">override_terms_matching</span></code> is set to <code class="docutils literal notranslate"><span class="pre">tokens</span></code>, it first splits the user_message in tokens (removing any punctuation marks or special characters), and then checks if any of the tokens of the user_message is present in the terms from <code class="docutils literal notranslate"><span class="pre">override_terms_in_user_message</span></code>. For example, the term “apple” would be found in the messages “I like apple” but not in “I like pineapples”.</p></li>
</ul>
<p>After completing the checks above, if any of the terms is found in the user_message, the function returns a dictionary containing:</p>
<ul class="simple">
<li><p>resp_speech: the text that needs to be provided to the user.</p></li>
<li><p>override_reason:  the reason for the override</p></li>
<li><p>override: True</p></li>
</ul>
<p>If none of the terms is found, the function returns a dictionary only containing the key override with the value False.</p>
</dd></dl>

<dl class="py function">
<dt id="helpers.rephrase.check_rephrase">
<code class="sig-prename descclassname">helpers.rephrase.</code><code class="sig-name descname">check_rephrase</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">resp_speech</span></em>, <em class="sig-param"><span class="n">conversation_code</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">conditionid</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#helpers.rephrase.check_rephrase" title="Permalink to this definition">¶</a></dt>
<dd><p>Receives a potential response by the agent and checks if it needs rephrasing. If required, replaces any text within square brackets by appropriate information depending on conditions specified in this function. Returns the agent response with the information required replace.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">config.yaml</span></code> file manages these replacements (section: <code class="docutils literal notranslate"><span class="pre">rephrases</span></code>).</p>
<blockquote>
<div><p>Some specific operations:</p>
<ul>
<li><p>If <code class="docutils literal notranslate"><span class="pre">conversation_code</span></code> is provided, the function will also look for the string <code class="docutils literal notranslate"><span class="pre">|CONVERSATIONCODE|</span></code> in the response, and substitute it by the value of the conversation_code.</p>
<blockquote>
<div><ul class="simple">
<li><p>This can be helpful for when the agent needs to provide a conversation_code to the user. For example, a message can be configured in the dialogue manager to say “This is your <code class="docutils literal notranslate"><span class="pre">|CONVERSATIONCODE|</span></code>”, and the check_rephrase function will automatically replace that piece of the string by the actual conversation code.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">conditionid</span></code> is not specified, the function will only look for items to rephrase in the <code class="docutils literal notranslate"><span class="pre">all_conditions</span></code> section of the <code class="docutils literal notranslate"><span class="pre">config.yaml</span></code> file.</p></li>
<li><p>If a <code class="docutils literal notranslate"><span class="pre">conditionid</span></code> is specified, the function will look also for items to rephrase in each of the conditions.</p>
<blockquote>
<div><ul class="simple">
<li><p>For example, if condition_1 indicates that TEXT1 should be replaced by A, and condition_2 indicates that TEXT1 should be replaced B, the check_rephrase function will provide rephrase the response “This is TEXT1” differently depending on the condition.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</dd></dl>

</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="tutorial.html" class="btn btn-neutral float-right" title="Tutorial" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="using.html" class="btn btn-neutral float-left" title="Using CART" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2018, Theo Araujo.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>